(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{284:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"rollup-基础实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-基础实践","aria-hidden":"true"}},[t._v("#")]),t._v(" rollup 基础实践")]),t._v(" "),a("p",[t._v("本文中的示例代码可以在"),a("a",{attrs:{href:"https://github.com/xuwenchao66/rollup-practice",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xuwenchao66/rollup-practice"),a("OutboundLink")],1),t._v("中查阅。")]),t._v(" "),a("h2",{attrs:{id:"开始使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 开始使用")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("全局安装 rollup。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --global rollup\n")])])])]),t._v(" "),a("li",[a("p",[t._v("新建工程、文件用于构建测试。")]),t._v(" "),a("p",[t._v("新建一个文件夹，用于测试。新建需要编译的文件 index.js 内容如下。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello rollup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("通过全局 CLI 执行构建。")]),t._v(" "),a("p",[t._v("执行下方命令，开始构建。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("rollup index.js --file dist/bundle.js --format es\n")])])]),a("p",[t._v("执行成功后可以发现，出现了一个 dist 文件夹，里面有一个 bundle.js，就是构建输出的文件。")]),t._v(" "),a("p",[t._v("命令简析：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("rollup index.js")]),t._v("： 使用 rollup 对 index.js 进行编译。")]),t._v(" "),a("li",[a("code",[t._v("--file dist/bundle.js")]),t._v("： 输出到"),a("code",[t._v("dist/bundle.js")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("--format es")]),t._v("：输出格式为 ES 模块。")])])])]),t._v(" "),a("h2",{attrs:{id:"使用配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用配置文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用配置文件")]),t._v(" "),a("p",[t._v("使用 CLI 能快速上手，但是落实到实践的时候，使用配置文件是更合适的选择，因为其可读性更好而且更强大。")]),t._v(" "),a("p",[t._v("通常配置文件是一个名为 rollup.config.js 的文件，该文件在项目根目录。配置文件导出一个对象。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("新增 rollup.config.js，其内容如下。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("指定配置文件，执行构建。")]),t._v(" "),a("p",[t._v("执行下方命令，成功构建。"),a("code",[t._v("--config")]),t._v("用于指定配置文件，也可用缩写"),a("code",[t._v("-c")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("rollup --config rollup.config.js\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"常用配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("input")]),t._v(" "),a("p",[t._v("构建入口描述，常用的是使用一个字符串来描述入口文件的所在位置。input 也可以是一个数组、对象，更多详细用法可查看"),a("a",{attrs:{href:"http://rollupjs.org/guide/en/#input",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#input"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("output")]),t._v(" "),a("p",[t._v("构建输出描述，通常一个对象，output 常用的属性有：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("output.file 指定输出文件。")])]),t._v(" "),a("li",[a("p",[t._v("output.format 指定输出的格式。可以是 es、cjs、umd 等常见的模块格式。")])])]),t._v(" "),a("p",[t._v("更多详细用法可查看"),a("a",{attrs:{href:"http://rollupjs.org/guide/en/#outputdir",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#output"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("单入口、单出口。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("单入口、多出口。")]),t._v(" "),a("p",[t._v("某些场景，我们的库可能需要同时提供给 browser、server 端使用。")]),t._v(" "),a("p",[t._v("所以需要同时输出 es、commonjs 规范模块，这时候可以把 input 声明为一个数组，这样就能一个入口拥有不同格式 的输出。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.es.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.cjs.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("多入口、多出口。")]),t._v(" "),a("p",[t._v("一个库可能有多个不同的入口文件，这时候可以使用数组来声明配置对象。我们新增一个 main.js 入口文件，然后使用如下配置就能够实现多入口、出口的构建。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/index.es.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/index.cjs.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    input"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'main.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/main.es.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'es'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/main.cjs.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        format"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"常用插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用插件","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用插件")]),t._v(" "),a("p",[t._v("在实践中我们往往会引用外部的 npm package，比如 lodash。同时为了兼容较低版本的浏览器，也需要将代码编译成 ES5。")]),t._v(" "),a("p",[t._v("在项目中安装 lodash，"),a("code",[t._v("npm i lodash")]),t._v("。")]),t._v(" "),a("p",[t._v("在 index.js 中引入使用 lodash，修改文件为。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cloneDeep "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lodash/cloneDeep'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("log")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello rollup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cloneDeep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("执行构建，可以发现，控制台中出现了警告，而且编译出来的代码，箭头函数还存在，没有编译为 ES5。")]),t._v(" "),a("p",[t._v("这是因为 rollup 本身只包含了其核心功能，其它应用所需功能以"),a("strong",[t._v("插件")]),t._v("的形式来实现。这样同时保证了 rollup 的扩展性、可维护性。")]),t._v(" "),a("h3",{attrs:{id:"rollup-plugin-node-resolve"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-plugin-node-resolve","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/node-resolve",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-node-resolve"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("通过控制台可以看到如下警告。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" Unresolved dependencies\nhttps://rollupjs.org/guide/en/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#warning-treating-module-as-external-dependency")]),t._v("\n")])])]),a("p",[t._v("这是因为 rollup 默认只会解析相对路径的模块，如"),a("code",[t._v("import main from './main.js'")]),t._v("。")]),t._v(" "),a("p",[t._v("当使用如"),a("code",[t._v("import cloneDeep from 'lodash/cloneDeep'")]),t._v("时，rollup 是不知道该如何找到该模块的，所以把此模块认为是 external（外置依赖）。")]),t._v(" "),a("p",[t._v("为了让 rollup 能够使用"),a("a",{attrs:{href:"https://nodejs.org/api/modules.html#modules_all_together",target:"_blank",rel:"noopener noreferrer"}},[t._v("nodejs 的模块解析方案"),a("OutboundLink")],1),t._v("，需要使用"),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/node-resolve",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-resolve"),a("OutboundLink")],1),t._v("插件。")]),t._v(" "),a("p",[t._v("安装依赖"),a("code",[t._v("npm install @rollup/plugin-node-resolve --save-dev")]),t._v("。")]),t._v(" "),a("p",[t._v("在配置中使用插件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeResolve "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nodeResolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这时候在此执行构建，会发现原有的警告消失了，说明 rollup 已经成功找到了模块。但是出现了另外一个报错。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Error: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'default'")]),t._v(" is not exported by "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/node_modules/lodash/cloneDeep.js, imported by index.js\nhttps://rollupjs.org/guide/en/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error-name-is-not-exported-by-module")]),t._v("\n")])])]),a("p",[t._v("这是因为 rollup 使用的是 ES 模块机制，无法解析 commonjs 的模块，所以如果需要引入 commonjs 模块，需要使用@rollup/plugin-commonjs 插件。")]),t._v(" "),a("h3",{attrs:{id:"rollup-plugin-commonjs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-plugin-commonjs","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/commonjs",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-commonjs"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("能够将 commonjs 模块转换成 ES 模块，这样 rollup 就能解析 commonjs 模块了。")]),t._v(" "),a("p",[t._v("安装依赖"),a("code",[t._v("npm install @rollup/plugin-commonjs --save-dev")]),t._v("。")]),t._v(" "),a("p",[t._v("修改配置文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeResolve "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" commonjs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-commonjs'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nodeResolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonjs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("再次构建，这次导入了 lodash，构建成功。")]),t._v(" "),a("h3",{attrs:{id:"rollup-plugin-babel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollup-plugin-babel","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/babel",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-babel"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("根据上面的了解，可知语法转译也需要安装插件来处理。")]),t._v(" "),a("p",[t._v("安装依赖"),a("code",[t._v("npm install @rollup/plugin-babel @babel/core --save-dev")]),t._v("。")]),t._v(" "),a("p",[t._v("修改配置文件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" nodeResolve "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-node-resolve'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" commonjs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-commonjs'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" babel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@rollup/plugin-babel'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nodeResolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonjs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("babel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("再次执行构建可以发现 ES6 的箭头函数、const 等语法糖都转译成 ES5。")]),t._v(" "),a("h3",{attrs:{id:"更多常用插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多常用插件","aria-hidden":"true"}},[t._v("#")]),t._v(" 更多常用插件")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/eslint",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-eslint"),a("OutboundLink")],1),t._v("，eslint。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/rollup/plugins/tree/master/packages/alias",target:"_blank",rel:"noopener noreferrer"}},[t._v("@rollup/plugin-alias"),a("OutboundLink")],1),t._v("，类似 webpack 的 alias 配置，为模块设置别名。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/TrySound/rollup-plugin-terser",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollup-plugin-terser"),a("OutboundLink")],1),t._v("，代码压缩。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/ritz078/rollup-plugin-filesize",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollup-plugin-filesize"),a("OutboundLink")],1),t._v("，展示构建输出的文件体积。")])]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/#faqs",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#faqs"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/#how-do-i-use-rollup-in-nodejs-with-commonjs-modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#how-do-i-use-rollup-in-nodejs-with-commonjs-modules"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://rollupjs.org/guide/en/#troubleshooting",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollupjs#troubleshooting"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);