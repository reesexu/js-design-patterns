(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{293:function(t,a,s){"use strict";s.r(a);var e=s(0),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"规范项目的-git-commit-message"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#规范项目的-git-commit-message","aria-hidden":"true"}},[t._v("#")]),t._v(" 规范项目的 Git Commit Message")]),t._v(" "),s("p",[t._v("每个项目少不了规范，然后作为记录项目发展的 Git 也应该规范化，规范的 commit message 便于我们记录、追溯问题，同时人机可读的规范也让项目自动化更简单，比如根据 commit message 自动生成 changelog 等等。")]),t._v(" "),s("p",[t._v("下面将介绍规范的 commit message，以及如何通过工具校验和高效生成满足规范的 commit message。")]),t._v(" "),s("h2",{attrs:{id:"规范介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#规范介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" 规范介绍")]),t._v(" "),s("p",[t._v("目前社区使用范围较广的是"),s("a",{attrs:{href:"https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines",target:"_blank",rel:"noopener noreferrer"}},[t._v("AngularJS 团队的 commit message 规范"),s("OutboundLink")],1),t._v("。该 message 格式由 3 部分组成，分别是 header、body、footer。一个 commit message 基本格式如下。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("scope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("subject"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("BLANK LINE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("BLANK LINE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("footer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h3",{attrs:{id:"header"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#header","aria-hidden":"true"}},[t._v("#")]),t._v(" header")]),t._v(" "),s("p",[t._v("首行为 header，是必须存在的。header 由三部分组成，分别是：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("type: 提交类型，必填。常用的有如下类型：")]),t._v(" "),s("ul",[s("li",[t._v("feat：新功能")]),t._v(" "),s("li",[t._v("fix：bug 修复")]),t._v(" "),s("li",[t._v("docs：文档修改")]),t._v(" "),s("li",[t._v("style: 不会修改代码运行逻辑的代码风格、格式改动（比如增、删加了空行、分号等等）")]),t._v(" "),s("li",[t._v("refactor：重构")]),t._v(" "),s("li",[t._v("perf：性能优化")]),t._v(" "),s("li",[t._v("test：添加、修改测试")]),t._v(" "),s("li",[t._v("chore：其它，比如项目的构建过程、辅助工具的调整（比如文档生成、release 及其方式）。")])])]),t._v(" "),s("li",[s("p",[t._v("scope：影响范围，选填。")])]),t._v(" "),s("li",[s("p",[t._v("subject：主题，本次提交的简短描述，必填。")])])]),t._v(" "),s("p",[t._v("所以一个规范的 header 可如右方所示："),s("code",[t._v("feat(src): add login page")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"body"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#body","aria-hidden":"true"}},[t._v("#")]),t._v(" body")]),t._v(" "),s("p",[t._v("body 为本次修改详细描述，比如描述本次修改的动机以及与以往的不同对比，body 为选填。")]),t._v(" "),s("h3",{attrs:{id:"footer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#footer","aria-hidden":"true"}},[t._v("#")]),t._v(" footer")]),t._v(" "),s("p",[t._v("footer 应该包含本次修改的 Breaking Changes 以及本次关闭了的 issues，footer 也为选填。")]),t._v(" "),s("h2",{attrs:{id:"使用规范校验工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用规范校验工具","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用规范校验工具")]),t._v(" "),s("p",[t._v("\b 口头约定往往容易被打破，为此我们需要工具来让团队所有人都严格遵守规范，所以出现了 eslint 等代码校验工具。 当然 commit message 也有对应的校验工具。")]),t._v(" "),s("h3",{attrs:{id:"安装校验工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装校验工具","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装校验工具")]),t._v(" "),s("p",[t._v("新建一个项目用于安装、测试。然后执行下方命令安装依赖。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g @commitlint/cli @commitlint/config-conventional\n")])])]),s("p",[t._v("我们使用"),s("a",{attrs:{href:"https://commitlint.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("@commitlint/cli"),s("OutboundLink")],1),t._v("来校验 commit message，而"),s("a",{attrs:{href:"https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional",target:"_blank",rel:"noopener noreferrer"}},[t._v("@commitlint/config-conventional"),s("OutboundLink")],1),t._v("约定式提交规范，是校验工具所遵循规范。我们也可以选择社区中的"),s("a",{attrs:{href:"https://github.com/conventional-changelog/commitlint#shared-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("其它规范"),s("OutboundLink")],1),t._v("，甚至自定义规范。")]),t._v(" "),s("h3",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),s("p",[t._v("unix 系统中可执行下方命令，生成 commitlint 的配置文件 commitlint.config.js。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"module.exports = {extends: ['@commitlint/config-conventional']}\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" commitlint.config.js\n")])])]),s("p",[t._v("或者可以选择手动新增配置文件 commitlint.config.js，该文件一般如下。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@commitlint/config-conventional'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("extends")]),t._v("：用于告诉校验工具应该继承使用哪个规范，这里使用了 @commitlint/config-conventional。")]),t._v(" "),s("p",[s("code",[t._v("ignores")]),t._v("：如果数组里面的函数返回 true，则会跳过检测。一些非人工的 commit，比如 merge 或者 CI 中的自动 commit，有时候我们并不期望对其进行检测，则可使用该参数。")]),t._v(" "),s("p",[t._v("更多配置项可查看"),s("a",{attrs:{href:"https://commitlint.js.org/#/reference-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("commitlint reference-configuration"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),s("p",[t._v("为了测试校验工具是否正确安装、配置，用 git 添加一个不规范的 commit message，比如 "),s("code",[t._v("test")]),t._v("。")]),t._v(" "),s("p",[t._v("然后执行"),s("code",[t._v("commitlint -e")]),t._v("触发 commitlint，"),s("code",[t._v("-e")]),t._v("参数用于校验最后一次的 commit message，执行命令后 terminal 出现如下错误，说明 message 有哪些点校验失败了。至此校验工具已安装、配置成功。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("⧗   input: "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n✖   subject may not be empty "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("subject-empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n✖   "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" may not be empty "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type-empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n✖   found "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" problems, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" warnings\nⓘ   Get help: https://github.com/conventional-changelog/commitlint/"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#what-is-commitlint")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用-git-hook-完成自动校验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-git-hook-完成自动校验","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用 git hook 完成自动校验")]),t._v(" "),s("p",[t._v("搭配"),s("a",{attrs:{href:"https://typicode.github.io/husky/#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("husky"),s("OutboundLink")],1),t._v("，让检测自动化，提交的时候如果 message 不符合规范，会提交失败，保证了团队内的提交都必须符合规范。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("安装 husky。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" husky --save-dev\n")])])])]),t._v(" "),s("li",[s("p",[t._v("激活 hooks。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("npx husky "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("配置 npm 钩子，在依赖安装完成后自动激活 hooks。")]),t._v(" "),s("p",[t._v("为了在团队内其他同事安装依赖后能自动激活 kooks，可在 package.json 的 script 中添加钩子，安装完依赖后自动激活钩子。")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"postinstall"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"husky install"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("添加 hooks。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("npx husky "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" .husky/commit-msg "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npx --no-install commitlint --edit '),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v('"')]),t._v("\n")])])]),s("p",[t._v("执行成功后会发现多了一个 .husky 的文件夹，里面就是 git hooks 相关执行文件。")])])]),t._v(" "),s("p",[t._v("最后，我们再对当前修改修改进行 add、commit，能够看见在 commit 时候就自动开始校验 message 了。")]),t._v(" "),s("h2",{attrs:{id:"高效生成规范的-commit-message"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#高效生成规范的-commit-message","aria-hidden":"true"}},[t._v("#")]),t._v(" 高效生成规范的 commit message")]),t._v(" "),s("p",[t._v("规范是有了，但此时会发现写个规范的 commit message 太费劲，效率低而且不利于在团队中推广。")]),t._v(" "),s("p",[t._v("所以可以使用"),s("a",{attrs:{href:"https://github.com/commitizen/cz-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("commitizen"),s("OutboundLink")],1),t._v("，以便能够通过简单交互操作就能写出规范的 commit message。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("安装 commitizen。")]),t._v(" "),s("ul",[s("li",[t._v("全局安装，方便使用全局 CLI。")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" commitizen -g\n")])])]),s("ul",[s("li",[t._v("项目中安装，防止别人因为没有全局安装，导致缺少依赖，触发失败。")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" commitizen -D\n")])])])]),t._v(" "),s("li",[s("p",[t._v("因为我们使用的是 conventional commit 规范，所以也对应的初始化项目的 commitizen 使用 cz-conventional-changelog 适配器。")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("commitizen init cz-conventional-changelog --save-dev --save-exact\n")])])])]),t._v(" "),s("li",[s("p",[t._v("最后在添加 npm script 命令，方便统一、快速调起 commitizen。")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"commit"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cz"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("安装、配置完成之后，执行"),s("code",[t._v("npm run commit")]),t._v("，就可以看见 terminal 中出现 commitizen 的交互界面，只要按照 terminal 中的描述一步步进行操作，就够生成规范的 commit message 了。")]),t._v(" "),s("p",[t._v("本文相关代码示例可从"),s("a",{attrs:{href:"https://github.com/xuwenchao66/standardize-git-commit-message",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/xuwenchao66/standardize-git-commit-message"),s("OutboundLink")],1),t._v("中进行查阅。")]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines",target:"_blank",rel:"noopener noreferrer"}},[t._v("AngularJS git-commit-guidelines"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Commit message 和 Change log 编写指南"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://commitlint.js.org/#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("commitlint.js"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://typicode.github.io/husky/#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("husky"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);